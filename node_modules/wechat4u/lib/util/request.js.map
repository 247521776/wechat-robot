{"version":3,"sources":["../../src/util/request.js"],"names":["Request","getPgv","c","Math","round","random","Date","defaults","headers","timeout","httpAgent","httpsAgent","axios","create","Cookie","interceptors","request","use","config","Object","keys","map","key","join","Promise","reject","err","response","setCookie","res","forEach","pm","item","match","options"],"mappings":";;;;;QAOgBA,O,GAAAA,O;;AAPhB;;;;AACA;;;;AAEA,IAAMC,SAAS,SAATA,MAAS,IAAK;AAClB,SAAO,CAACC,KAAK,EAAN,IAAYC,KAAKC,KAAL,CAAW,cAAcD,KAAKE,MAAL,MAAiB,GAA/B,CAAX,KAAmD,CAAC,IAAIC,IAAJ,EAAD,GAAc,IAAjE,CAAnB;AACD,CAFD;;AAIO,SAASN,OAAT,CAAkBO,QAAlB,EAA4B;AAAA;;AACjCA,aAAWA,YAAY,EAAvB;AACAA,WAASC,OAAT,GAAmBD,SAASC,OAAT,IAAoB,EAAvC;AACA,MAAI,6BAAJ,EAA2B;AACzBD,aAASC,OAAT,CAAiB,YAAjB,IAAiCD,SAASC,OAAT,CAAiB,YAAjB,KAAkC,2HAAnE;AACAD,aAASC,OAAT,CAAiB,YAAjB,IAAiCD,SAASC,OAAT,CAAiB,YAAjB,KAAkC,OAAnE;AACD;;AAEDD,WAASE,OAAT,GAAmB,OAAO,EAA1B;AACAF,WAASG,SAAT,GAAqB,KAArB;AACAH,WAASI,UAAT,GAAsB,KAAtB;;AAEA,OAAKC,KAAL,GAAa,gBAAMC,MAAN,CAAaN,QAAb,CAAb;AACA,MAAI,6BAAJ,EAA2B;AACzB,SAAKO,MAAL,GAAcP,SAASO,MAAT,IAAmB,EAAjC;AACA,SAAKA,MAAL,CAAY,SAAZ,IAAyBb,QAAzB;AACA,SAAKa,MAAL,CAAY,QAAZ,IAAwBb,OAAO,GAAP,CAAxB;AACA,SAAKW,KAAL,CAAWG,YAAX,CAAwBC,OAAxB,CAAgCC,GAAhC,CAAoC,kBAAU;AAC5CC,aAAOV,OAAP,CAAe,QAAf,IAA2BW,OAAOC,IAAP,CAAY,MAAKN,MAAjB,EAAyBO,GAAzB,CAA6B,eAAO;AAC7D,eAAUC,GAAV,SAAiB,MAAKR,MAAL,CAAYQ,GAAZ,CAAjB;AACD,OAF0B,EAExBC,IAFwB,CAEnB,IAFmB,CAA3B;AAGA,aAAOL,MAAP;AACD,KALD,EAKG,eAAO;AACR,aAAOM,QAAQC,MAAR,CAAeC,GAAf,CAAP;AACD,KAPD;AAQA,SAAKd,KAAL,CAAWG,YAAX,CAAwBY,QAAxB,CAAiCV,GAAjC,CAAqC,eAAO;AAC1C,UAAIW,YAAYC,IAAIrB,OAAJ,CAAY,YAAZ,CAAhB;AACA,UAAIoB,SAAJ,EAAe;AACbA,kBAAUE,OAAV,CAAkB,gBAAQ;AACxB,cAAIC,KAAKC,KAAKC,KAAL,CAAW,sBAAX,CAAT;AACA,cAAIF,EAAJ,EAAQ;AACN,kBAAKjB,MAAL,CAAYiB,GAAG,CAAH,CAAZ,IAAqBA,GAAG,CAAH,CAArB;AACD;AACF,SALD;AAMD;AACD,aAAOF,GAAP;AACD,KAXD,EAWG,eAAO;AACR,UAAIH,OAAOA,IAAIC,QAAf,EAAyB;AACvB,eAAOD,IAAIC,QAAJ,CAAaX,OAApB;AACA,eAAOU,IAAIC,QAAJ,CAAaT,MAApB;AACD;AACD,aAAOM,QAAQC,MAAR,CAAeC,GAAf,CAAP;AACD,KAjBD;AAkBD;;AAED,OAAKV,OAAL,GAAe,mBAAW;AACxB,WAAO,MAAKJ,KAAL,CAAWI,OAAX,CAAmBkB,OAAnB,CAAP;AACD,GAFD;;AAIA,SAAO,KAAKlB,OAAZ;AACD","file":"request.js","sourcesContent":["import axios from 'axios'\r\nimport {isStandardBrowserEnv} from './global'\r\n\r\nconst getPgv = c => {\r\n  return (c || '') + Math.round(2147483647 * (Math.random() || 0.5)) * (+new Date() % 1E10)\r\n}\r\n\r\nexport function Request (defaults) {\r\n  defaults = defaults || {}\r\n  defaults.headers = defaults.headers || {}\r\n  if (!isStandardBrowserEnv) {\r\n    defaults.headers['user-agent'] = defaults.headers['user-agent'] || 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.109 Safari/537.36'\r\n    defaults.headers['connection'] = defaults.headers['connection'] || 'close'\r\n  }\r\n\r\n  defaults.timeout = 1000 * 60\r\n  defaults.httpAgent = false\r\n  defaults.httpsAgent = false\r\n\r\n  this.axios = axios.create(defaults)\r\n  if (!isStandardBrowserEnv) {\r\n    this.Cookie = defaults.Cookie || {}\r\n    this.Cookie['pgv_pvi'] = getPgv()\r\n    this.Cookie['pgv_si'] = getPgv('s')\r\n    this.axios.interceptors.request.use(config => {\r\n      config.headers['cookie'] = Object.keys(this.Cookie).map(key => {\r\n        return `${key}=${this.Cookie[key]}`\r\n      }).join('; ')\r\n      return config\r\n    }, err => {\r\n      return Promise.reject(err)\r\n    })\r\n    this.axios.interceptors.response.use(res => {\r\n      let setCookie = res.headers['set-cookie']\r\n      if (setCookie) {\r\n        setCookie.forEach(item => {\r\n          let pm = item.match(/^(.+?)\\s?\\=\\s?(.+?);/)\r\n          if (pm) {\r\n            this.Cookie[pm[1]] = pm[2]\r\n          }\r\n        })\r\n      }\r\n      return res\r\n    }, err => {\r\n      if (err && err.response) {\r\n        delete err.response.request\r\n        delete err.response.config\r\n      }\r\n      return Promise.reject(err)\r\n    })\r\n  }\r\n\r\n  this.request = options => {\r\n    return this.axios.request(options)\r\n  }\r\n\r\n  return this.request\r\n}\r\n"]}